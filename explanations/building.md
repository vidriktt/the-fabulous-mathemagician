# JavaScript build process example

## Running the application

```
yarn install
yarn build
open public/index.html
```

### Expected behaviour

* A title in the center of a greenish background is seen on the page
* "I'm a robot" is logged to browser console

## Explanation

### Dependency installation

```
yarn install
```

Installs all the dependencies that are listed in package.json. The dependencies usually target the NPM repository, but
can target a public VCS repository (e.g GitHub). The `npm` dependency management and installation tool can also be used,
but `yarn` has mostly superseded it by being faster and having saner defaults.

* [Yarn][-3]
* [NPM repository][-2]
* [NPM CLI][-1]

### Build scripts

```
yarn build
```

`build` refers to the `build` script that is defined in
[_
package.json_](https://github.com/urmastalimaa/interactive-frontend-development/tree/master/lecture_1/package.json#L29).
This is equivalent to running `./node_modules/.bin/rollup --config rollup.config.js` from the command line.

### Rollup

Rollup generates a JavaScript file (_public/app.js_) using the specified configuration file
([_
rollup.config.js_](https://github.com/urmastalimaa/interactive-frontend-development/tree/master/lecture_1/rollup.config.js))
. Rollup resolves all module imports and outputs one file that can be included in the browser using a `<script>` tag.
Various plugins can be included in the build process to perform additional changes to the source files.

#### Babel

JavaScript is a fast-changing language with many different runtimes (browsers and their versions). Babel allows using
desired JavaScript features and syntax in the source code and _transpiling_ the source code to be parseable and
executable by various browsers and their versions.

`@rollup/plugin-babel` (in rollup.config.js) combines the transpilation process into the build process.
[_
babel.config.json_](https://github.com/urmastalimaa/interactive-frontend-development/tree/master/lecture_1/babel.config.json)
is used to configure Babel itself.

_babel.config.json_ uses `@babel/preset-env` to _target_ specific browsers, specified using [browserlist][0], and also
defines plugins to further transform source code.

Compare the distribution JavaScript file generated by `yarn build` with the files in src/. Try running `yarn build` with
different browser targets (i.e remove "IE 10" from _.browserlistrc_) and see how the distribution file changes (search
for `Game`).

#### Building on source file change

`yarn build:watch` refers to the `build:watch` script that is defined in
[_
package.json_](https://github.com/urmastalimaa/interactive-frontend-development/tree/master/lecture_1/package.json#L30).
This is equivalent to running `./node_modules/.bin/rollup --config rollup.config.js --watch`. The `watch` flag instructs
Rollup to automatically rebuild the bundle whenever any source file changes. New changes are visible after refreshing
the web application in the browser.

[Learn more][1]

#### Refreshing whenever source files change

Refreshing manually is tiring and error-prone. In _rollup.config.js_ the
`livereload` plugin is used to inject JavaScript into our application that will connect to the Rollup build process and
automatically reload the web page when changes are detected. Note that for this to work, you can no longer simply open
the public/index.html file, but need to open localhost:10001 in a web browser.

```
rollup v2.39.1
bundles src/index.js â†’ public/app.js...
http://localhost:10001 -> your-work-dir/interactive-frontend-development/lecture_1/public
LiveReload enabled
created public/app.js in 1.4s
```

#### Source Maps

[_
rollup.config.js_](https://github.com/urmastalimaa/interactive-frontend-development/tree/master/lecture_1/rollup.config.js#L16)
defines `sourcemap: true` which instructs Rollup to add a link to the source code definitions to the end of app.js. This
link is call a _source map_.

A _source map_ is a file which maps the transformed source (app.js) to the original source (multiple files in src.js).
In the current case, a _source map_
isn't an URL to a file, but a base64 encoding of the whole source definition in base64. A web-browser will map the
generated file (app.js) to the original source. This allows both the browser to execute JavaScript that it supports and
the developer to debug their original, unchanged source code.

[Learn more][3]

[-3]: https://yarnpkg.com/en/

[-2]: https://www.npmjs.com/

[-1]: https://docs.npmjs.com/getting-started/what-is-npm

[0]: https://github.com/ai/browserslist

[1]: https://rollupjs.org/guide/en/#rollupwatch

[2]: https://developer.mozilla.org/en-US/docs/Tools/Debugger/How_to/Use_a_source_map
